!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebIDL2=t():e.WebIDL2=t()}(this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(r,s,function(t){return e[t]}.bind(null,s));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";function r(e,t,n,r,s){function a(n){return n>0?e.slice(t,t+n):e.slice(Math.max(t+n,0),t)}function i(n,{precedes:r}={}){const s=n.map(e=>e.trivia+e.value).join(""),a=e[t];return"eof"===a.type?s:r?s+a.trivia:s.slice(a.trivia.length)}const o="eof"!==e[t].type?e[t].line:e.length>1?e[t-1].line:1,u=function(e){const t=e.split("\n");return t[t.length-1]}(i(a(-5),{precedes:!0})),c=a(5),l=i(c),p=u+l.split("\n")[0]+"\n"+(" ".repeat(u.length)+"^ "+r);return{message:`${s} error at line ${o}${n?`, ${"Syntax"===s?"since":"inside"} \`${n.partial?"partial ":""}${n.type} ${n.name}\``:""}:\n${p}`,line:o,input:l,tokens:c}}function s(e,t,n,s){return r(e,t.index,n,s,"Validation").message}n.r(t);const a={decimal:/-?(?=[0-9]*\.|[0-9]+[eE])(([0-9]+\.[0-9]*|[0-9]*\.[0-9]+)([Ee][-+]?[0-9]+)?|[0-9]+[Ee][-+]?[0-9]+)/y,integer:/-?(0([Xx][0-9A-Fa-f]+|[0-7]*)|[1-9][0-9]*)/y,identifier:/[_-]?[A-Za-z][0-9A-Z_a-z-]*/y,string:/"[^"]*"/y,whitespace:/[\t\n\r ]+/y,comment:/((\/(\/.*|\*([^*]|\*[^\/])*\*\/)[\t\n\r ]*)+)/y,other:/[^\t\n\r 0-9A-Za-z]/y},i=["ByteString","DOMString","USVString"],o=["attribute","callback","const","deleter","dictionary","enum","getter","includes","inherit","interface","iterable","maplike","namespace","partial","required","setlike","setter","static","stringifier","typedef","unrestricted"],u=["-Infinity","FrozenArray","Infinity","NaN","Promise","boolean","byte","double","false","float","implements","legacyiterable","long","mixin","null","octet","optional","or","readonly","record","sequence","short","true","unsigned","void"].concat(o,i),c=["(",")",",","...",":",";","<","=",">","?","[","]","{","}"];class l extends Error{constructor({message:e,line:t,input:n,tokens:r}){super(e),this.name="WebIDLParseError",this.line=t,this.input=n,this.tokens=r}}function p(e){e=e.slice();let t=null;const n="decimal",s="integer",a="identifier",u="string";function c(n){throw new l(function(e,t,n,s){return r(e,t,n,s,"Syntax")}(e,p,t,n))}let p=0;function d(t){return e.length>p&&e[p].type===t}function f(...t){for(let n of t){if(!d(n))continue;const t=e[p];return p++,t}}function m(e){return e.startsWith("_")?e.slice(1):e}function y(e){p=e}function k({parser:e,allowDangler:t,listName:n="list"}){const r=e();if(!r)return[];r.tokens.separator=f(",");const s=[r];for(;r.tokens.separator;){const r=e();if(!r){t||c(`Trailing comma in ${n}`);break}if(r.tokens.separator=f(","),s.push(r),!r.tokens.separator)break}return s}class b{constructor({tokens:t}){Object.defineProperties(this,{source:{value:e},tokens:{value:t}})}toJSON(){const e={type:void 0,name:void 0};let t=this;for(;t!==Object.prototype;){const n=Object.getOwnPropertyDescriptors(t);for(const[t,r]of Object.entries(n))(r.enumerable||r.get)&&(e[t]=this[t]);t=Object.getPrototypeOf(t)}return e}}function g(){const e=function(){const e=f("unsigned"),t=f("short","long");if(t){const n=f("long");return new w({tokens:{prefix:e,base:t,postfix:n}})}e&&c("Failed to parse integer type")}()||function(){const e=f("unrestricted"),t=f("float","double");if(t)return new w({tokens:{prefix:e,base:t}});e&&c("Failed to parse float type")}();if(e)return e;const t=f("boolean","byte","octet");return t?new w({tokens:{base:t}}):void 0}function h(){return f("true","false","Infinity","-Infinity","NaN",n,s)}function v(e){switch(e.type){case"true":case"false":return{type:"boolean",value:"true"===e.type};case"Infinity":case"-Infinity":return{type:"Infinity",negative:e.type.startsWith("-")};case n:case s:return{type:"number",value:e.value};case"[":return{type:"sequence",value:[]};case u:return{type:u,value:e.value.slice(1,-1)};default:return{type:e.type}}}function x(e){const t=f("?");t&&(e.tokens.nullable=t),d("?")&&c("Can't nullable more than once")}class w extends b{constructor({tokens:e}){super({tokens:e}),Object.defineProperty(this,"subtype",{value:[]}),this.extAttrs=null}get generic(){return""}get nullable(){return!!this.tokens.nullable}get union(){return!1}get idlType(){if(this.subtype.length)return this.subtype;return m([this.tokens.prefix,this.tokens.base,this.tokens.postfix].filter(e=>e).map(e=>e.value).join(" "))}}class T extends w{static parse(e){const t=f("FrozenArray","Promise","sequence","record");if(!t)return;const n=new T({tokens:{base:t}});switch(n.tokens.open=f("<")||c(`No opening bracket after ${t.type}`),t.type){case"Promise":{d("[")&&c("Promise type cannot have extended attribute");const t=_(e)||c("Missing Promise subtype");n.subtype.push(t);break}case"sequence":case"FrozenArray":{const r=A(e)||c(`Missing ${t.type} subtype`);n.subtype.push(r);break}case"record":{d("[")&&c("Record key cannot have extended attribute");const t=f(...i)||c(`Record key must be one of: ${i.join(", ")}`),r=new w({tokens:{base:t}});r.tokens.separator=f(",")||c("Missing comma after record key type"),r.type=e;const s=A(e)||c("Error parsing generic type record");n.subtype.push(r,s);break}}return n.idlType||c(`Error parsing generic type ${t.type}`),n.tokens.close=f(">")||c(`Missing closing bracket after ${t.type}`),n}get generic(){return this.tokens.base.value}}class N extends w{static parse(e){const t={};if(t.open=f("("),!t.open)return;const n=new N({tokens:t});for(n.type=e||null;;){const e=A()||c("No type after open parenthesis or 'or' in union type");"any"===e.idlType&&c("Type `any` cannot be included in a union type"),n.subtype.push(e);const t=f("or");if(!t)break;e.tokens.separator=t}return n.idlType.length<2&&c("At least two types are expected in a union type but found less"),t.close=f(")")||c("Unterminated union type"),x(n),n}get union(){return!0}}function $(e){return function(e){let t=T.parse(e)||g();if(!t){const e=f(a,...i);if(!e)return;t=new w({tokens:{base:e}}),d("<")&&c(`Unsupported generic type ${e.value}`)}return"Promise"===t.generic&&d("?")&&c("Promise type cannot be nullable"),t.type=e||null,x(t),t.nullable&&"any"===t.idlType&&c("Type `any` cannot be made nullable"),t}(e)||N.parse(e)}function A(e){const t=U.parse(),n=$(e);return n&&(n.extAttrs=t),n}class j extends b{static parse(){const e=p,t={},n=new j({tokens:t});return t.optional=f("optional"),n.idlType=A("argument-type"),n.idlType?(t.optional||(t.variadic=f("...")),t.name=f(a,...o),t.name?(n.default=t.optional?I.parse():null,n):y(e)):y(e)}get optional(){return!!this.tokens.optional}get variadic(){return!!this.tokens.variadic}get name(){return m(this.tokens.name.value)}}function M(){return k({parser:j.parse,listName:"arguments list"})}class O extends b{static parser(e){return()=>{const t=f(e);if(t)return new O({tokens:{value:t}})}}get value(){return this.tokens.value.value}}class P extends b{static parse(){const e={assign:f("=")},t=new P({tokens:e});return e.assign&&(e.secondaryName=f(a,n,s,u)),e.open=f("("),e.open?(t.list="identifier-list"===t.rhsType?function(){const e=k({parser:O.parser(a),listName:"identifier list"});return e.length||c("Expected identifiers but none found"),e}():M(),e.close=f(")")||c("Unexpected token in extended attribute argument list")):t.hasRhs&&!e.secondaryName&&c("No right hand side to extended attribute assignment"),t}get rhsType(){return this.tokens.assign?this.tokens.secondaryName?this.tokens.secondaryName.type:"identifier-list":null}}class q extends b{static parse(){const e=f(a);if(e)return new q({tokens:{name:e},params:P.parse()})}constructor({tokens:e,params:t}){super({tokens:e}),Object.defineProperty(this,"params",{value:t})}get type(){return"extended-attribute"}get name(){return this.tokens.name.value}get rhs(){const{rhsType:e,tokens:t,list:n}=this.params;return e?{type:e,value:"identifier-list"===e?n:t.secondaryName.value}:null}get arguments(){const{rhsType:e,list:t}=this.params;return t&&"identifier-list"!==e?t:[]}}class U extends b{static parse(){const e={};if(e.open=f("["),!e.open)return null;const t=new U({tokens:e});return t.items=k({parser:q.parse,listName:"extended attribute"}),e.close=f("]")||c("Unexpected form of extended attribute"),t.items.length||c("Found an empty extended attribute"),t}}class I extends b{static parse(){const e=f("=");if(!e)return null;const t=h()||f(u,"null","[")||c("No value for default"),n=[t];if("["===t.type){const e=f("]")||c("Default sequence value must be empty");n.push(e)}return new I({tokens:{assign:e},expression:n})}constructor({tokens:e,expression:t}){super({tokens:e}),Object.defineProperty(this,"expression",{value:t})}get type(){return v(this.expression[0]).type}get value(){return v(this.expression[0]).value}get negative(){return v(this.expression[0]).negative}}class S extends b{static parse(){const e={};if(e.base=f("const"),!e.base)return;let t=g();if(!t){const e=f(a)||c("No type for const");t=new w({tokens:{base:e}})}d("?")&&c("Unexpected nullable constant type"),t.type="const-type",e.name=f(a)||c("No name for const"),e.assign=f("=")||c("No value assignment for const"),e.value=h()||c("No value for const"),e.termination=f(";")||c("Unterminated const");const n=new S({tokens:e});return n.idlType=t,n}get type(){return"const"}get name(){return m(this.tokens.name.value)}get value(){return v(this.tokens.value)}}class E extends b{static parse(e){const n={base:e},r=new E({tokens:n});return n.name=f(a)||c("No name for callback"),t=r,n.assign=f("=")||c("No assignment in callback"),r.idlType=_()||c("Missing return type"),n.open=f("(")||c("No arguments in callback"),r.arguments=M(),n.close=f(")")||c("Unterminated callback"),n.termination=f(";")||c("Unterminated callback"),r}get type(){return"callback"}get name(){return m(this.tokens.name.value)}}class F extends b{static parse({special:e,noInherit:t=!1,readonly:n=!1}={}){const r=p,s={special:e},i=new F({tokens:s});if(e||t||(s.special=f("inherit")),s.readonly=f("readonly"),n&&!s.readonly&&d("attribute")&&c("Attributes must be readonly in this context"),s.base=f("attribute"),s.base){switch(i.idlType=A("attribute-type")||c("No type in attribute"),i.idlType.generic){case"sequence":case"record":c(`Attributes cannot accept ${i.idlType.generic} types`)}return s.name=f(a,"required")||c("No name in attribute"),s.termination=f(";")||c("Unterminated attribute"),i}y(r)}get type(){return"attribute"}get special(){return this.tokens.special?this.tokens.special.value:""}get readonly(){return!!this.tokens.readonly}get name(){return m(this.tokens.name.value)}}function _(e){const t=$(e||"return-type");if(t)return t;const n=f("void");if(n){const e=new w({tokens:{base:n}});return e.type="return-type",e}}class D extends b{static parse(){const e={},t=new D({tokens:e});return t.idlType=_()||c("Missing return type"),e.name=f(a),e.open=f("(")||c("Invalid operation"),t.arguments=M(),e.close=f(")")||c("Unterminated operation"),t}get name(){const{name:e}=this.tokens;return e?m(e.value):""}}class z extends b{static parse({special:e,regular:t}={}){const n={special:e},r=new z({tokens:n});return e&&"stringifier"===e.value&&(n.termination=f(";"),n.termination)?(r.body=null,r):(e||t||(n.special=f("getter","setter","deleter")),r.body=D.parse(),n.termination=f(";")||c("Unterminated attribute"),r)}get type(){return"operation"}get name(){return this.body&&this.body.name||""}get special(){return this.tokens.special?this.tokens.special.value:""}}function R(){const e=f("static");if(e)return F.parse({special:e})||z.parse({special:e})||c("No body in static member")}function W(){const e=f("stringifier");if(e)return F.parse({special:e})||z.parse({special:e})||c("Unterminated stringifier")}class Z extends b{static parse(){const e=p,t={},n=new Z({tokens:t});if(t.readonly=f("readonly"),t.base=t.readonly?f("maplike","setlike"):f("iterable","maplike","setlike"),!t.base)return void y(e);const{type:r}=n,s="maplike"===r,a=s||"iterable"===r;t.open=f("<")||c(`Error parsing ${r} declaration`);const i=A()||c(`Error parsing ${r} declaration`);return n.idlType=[i],a&&(i.tokens.separator=f(","),i.tokens.separator?n.idlType.push(A()):s&&c(`Missing second type argument in ${r} declaration`)),t.close=f(">")||c(`Unterminated ${r} declaration`),t.termination=f(";")||c(`Missing semicolon after ${r} declaration`),n}get type(){return this.tokens.base.value}get readonly(){return!!this.tokens.readonly}}class B extends b{static parse(){const e=f(":");if(!e)return;const t=f(a)||c("No type in inheritance");return new B({tokens:{colon:e,name:t}})}get name(){return m(this.tokens.name.value)}}class L extends b{static parse(e,{type:n,inheritable:r,allowedMembers:s}){const{tokens:i}=e;for(i.name=f(a)||c("No name for interface"),t=e,r&&(e.inheritance=B.parse()||null),i.open=f("{")||c(`Bodyless ${n}`),e.members=[];;){if(i.close=f("}"),i.close)return i.termination=f(";")||c(`Missing semicolon after ${n}`),e;const t=U.parse();let r;for(const[e,...t]of s)if(r=e(...t))break;r||c("Unknown member"),r.extAttrs=t,e.members.push(r)}}get partial(){return!!this.tokens.partial}get name(){return m(this.tokens.name.value)}}class V extends L{static parse(e,{callback:t=null,partial:n=null}={}){const r={callback:t,partial:n,base:e};return L.parse(new V({tokens:r}),{type:"interface",inheritable:!n,allowedMembers:[[S.parse],[R],[W],[Z.parse],[F.parse],[z.parse]]})}get type(){return this.tokens.callback?"callback interface":"interface"}}class C extends L{static parse(e,{partial:t}={}){const n={partial:t,base:e};if(n.mixin=f("mixin"),n.mixin)return L.parse(new C({tokens:n}),{type:"interface mixin",allowedMembers:[[S.parse],[W],[F.parse,{noInherit:!0}],[z.parse,{regular:!0}]]})}get type(){return"interface mixin"}}function J(e){const t=f("interface");if(t)return C.parse(t,e)||V.parse(t,e)||c("Interface has no proper body")}class X extends L{static parse({partial:e}={}){const t={partial:e};if(t.base=f("namespace"),t.base)return L.parse(new X({tokens:t}),{type:"namespace",allowedMembers:[[F.parse,{noInherit:!0,readonly:!0}],[z.parse,{regular:!0}]]})}get type(){return"namespace"}}class G extends L{static parse({partial:e}={}){const t={partial:e};if(t.base=f("dictionary"),t.base)return L.parse(new G({tokens:t}),{type:"dictionary",inheritable:!e,allowedMembers:[[H.parse]]})}get type(){return"dictionary"}}class H extends b{static parse(){const e={},t=new H({tokens:e});return t.extAttrs=U.parse(),e.required=f("required"),t.idlType=A("dictionary-type")||c("No type for dictionary member"),e.name=f(a)||c("No name for dictionary member"),t.default=I.parse(),e.required&&t.default&&c("Required member must not have a default"),e.termination=f(";")||c("Unterminated dictionary member"),t}get type(){return"field"}get name(){return m(this.tokens.name.value)}get required(){return!!this.tokens.required}}class K extends b{static parse(){const e={};if(e.base=f("enum"),e.base)return e.name=f(a)||c("No name for enum"),t=new K({tokens:e}),e.open=f("{")||c("Bodyless enum"),t.values=k({parser:Q.parse,allowDangler:!0,listName:"enumeration"}),d(u)&&c("No comma between enum values"),e.close=f("}")||c("Unexpected value in enum"),t.values.length||c("No value in enum"),e.termination=f(";")||c("No semicolon after enum"),t}get type(){return"enum"}get name(){return m(this.tokens.name.value)}}class Q extends O{static parse(){const e=f(u);if(e)return new Q({tokens:{value:e}})}get type(){return"enum-value"}get value(){return super.value.slice(1,-1)}}class Y extends b{static parse(){const e={},n=new Y({tokens:e});if(e.base=f("typedef"),e.base)return n.idlType=A("typedef-type")||c("No type in typedef"),e.name=f(a)||c("No name in typedef"),t=n,e.termination=f(";")||c("Unterminated typedef"),n}get type(){return"typedef"}get name(){return m(this.tokens.name.value)}}class ee extends b{static parse(){const e=f(a);if(!e)return;const t={target:e};if(t.includes=f("includes"),t.includes)return t.mixin=f(a)||c("Incomplete includes statement"),t.termination=f(";")||c("No terminating ; for includes statement"),new ee({tokens:t});y(e.index)}get type(){return"includes"}get target(){return m(this.tokens.target.value)}get includes(){return m(this.tokens.mixin.value)}}function te(){return function(){const e=f("callback");if(!e)return;const t=f("interface");return t?V.parse(t,{callback:e}):E.parse(e)}()||J()||function(){const e=f("partial");if(e)return G.parse({partial:e})||J({partial:e})||X.parse({partial:e})||c("Partial doesn't apply to anything")}()||G.parse()||K.parse()||Y.parse()||ee.parse()||X.parse()}const ne=function(){if(!e.length)return[];const t=[];for(;;){const e=U.parse(),n=te();if(!n){e&&c("Stray extended attributes");break}n.extAttrs=e,t.push(n)}return t.push(f("eof")),t}();return p<e.length&&c("Unrecognised tokens"),ne}function d(e){return p(function(e){const t=[];let n=0,r="",s=1,i=0;for(;n<e.length;){const a=e.charAt(n);let l=-1;if(/[\t\n\r ]/.test(a)?l=o("whitespace",{noFlushTrivia:!0}):"/"===a&&(l=o("comment",{noFlushTrivia:!0})),-1!==l){const e=t.pop().value;s+=(e.match(/\n/g)||[]).length,r+=e,i-=1}else if(/[-0-9.A-Z_a-z]/.test(a)){if(-1===(l=o("decimal"))&&(l=o("integer")),-1===l){l=o("identifier");const e=t[t.length-1];-1!==l&&u.includes(e.value)&&(e.type=e.value)}}else'"'===a&&(l=o("string"));for(const a of c)if(e.startsWith(a,n)){t.push({type:a,value:a,trivia:r,line:s,index:i}),r="",l=n+=a.length;break}if(-1===l&&(l=o("other")),-1===l)throw new Error("Token stream not progressing");n=l,i+=1}return t.push({type:"eof",value:"",trivia:r}),t;function o(o,{noFlushTrivia:u}={}){const c=a[o];c.lastIndex=n;const l=c.exec(e);return l?(t.push({type:o,value:l[0],trivia:r,line:s,index:i}),u||(r=""),c.lastIndex):-1}}(e))}function f(e){return e}const m={wrap:e=>e.join(""),trivia:f,name:f,reference:f,type:f,inheritance:f,definition:f,extendedAttribute:f,extendedAttributeReference:f};function y(e,{templates:t=m}={}){function n(e,...n){return t.wrap([].concat(...e.map((e,t)=>[e,n[t]||""])))}function r(e,n){return t.reference(e,n||e)}function s(e,r){return e?n`${t.trivia(e.trivia)}${r||e.value}`:""}function a(e,s){return e?n`${t.trivia(e.trivia)}${r(e.value,s)}`:""}function i(e,r){return e?n`${t.trivia(e.trivia)}${t.name(e.value,r)}`:""}function o(e){if(e.union||e.generic)return t.wrap([a(e.tokens.base),s(e.tokens.open),...e.subtype.map(u),s(e.tokens.close)]);const n=e.tokens.prefix||e.tokens.base,i=e.tokens.prefix?[e.tokens.prefix.value,t.trivia(e.tokens.base.trivia)]:[],o=r(t.wrap([...i,e.tokens.base.value,s(e.tokens.postfix)]),e.idlType);return t.wrap([t.trivia(n.trivia),o])}function u(e){return t.wrap([f(e.extAttrs),o(e),s(e.tokens.nullable),s(e.tokens.separator)])}function c(e){return e?t.wrap([s(e.tokens.assign),...e.expression.map(e=>s(e))]):""}function l(e){return t.wrap([f(e.extAttrs),s(e.tokens.optional),t.type(u(e.idlType)),s(e.tokens.variadic),i(e.tokens.name,{data:e}),c(e.default),s(e.tokens.separator)])}function p(e){return t.wrap([a(e.tokens.value),s(e.tokens.separator)])}function d(e){const{rhsType:n}=e.params;return t.wrap([t.trivia(e.tokens.name.trivia),t.extendedAttribute(t.wrap([t.extendedAttributeReference(e.name),s(e.params.tokens.assign),a(e.params.tokens.secondaryName),s(e.params.tokens.open),...e.params.list?e.params.list.map("identifier-list"===n?p:l):[],s(e.params.tokens.close)])),s(e.tokens.separator)])}function f(e){return e?t.wrap([s(e.tokens.open),...e.items.map(d),s(e.tokens.close)]):""}function y(e){return t.definition(t.wrap([f(e.extAttrs),s(e.tokens.callback),s(e.tokens.partial),s(e.tokens.base),s(e.tokens.mixin),i(e.tokens.name,{data:e}),(n=e.inheritance,n?t.wrap([s(n.tokens.colon),t.trivia(n.tokens.name.trivia),t.inheritance(r(n.tokens.name.value,n.name))]):""),s(e.tokens.open),g(e.members,e),s(e.tokens.close),s(e.tokens.termination)]),{data:e});var n}function k(e,n){return t.definition(t.wrap([f(e.extAttrs),s(e.tokens.readonly),s(e.tokens.base),s(e.tokens.open),t.wrap(e.idlType.map(u)),s(e.tokens.close),s(e.tokens.termination)]),{data:e,parent:n})}t=Object.assign({},m,t);const b={interface:y,"interface mixin":y,namespace:y,operation:function(e,n){const r=e.body?[t.type(u(e.body.idlType)),i(e.body.tokens.name,{data:e,parent:n}),s(e.body.tokens.open),t.wrap(e.body.arguments.map(l)),s(e.body.tokens.close)]:[];return t.definition(t.wrap([f(e.extAttrs),s(e.tokens.special),...r,s(e.tokens.termination)]),{data:e,parent:n})},attribute:function(e,n){return t.definition(t.wrap([f(e.extAttrs),s(e.tokens.special),s(e.tokens.readonly),s(e.tokens.base),t.type(u(e.idlType)),i(e.tokens.name,{data:e,parent:n}),s(e.tokens.termination)]),{data:e,parent:n})},dictionary:y,field:function(e,n){return t.definition(t.wrap([f(e.extAttrs),s(e.tokens.required),t.type(u(e.idlType)),i(e.tokens.name,{data:e,parent:n}),c(e.default),s(e.tokens.termination)]),{data:e,parent:n})},const:function(e,n){return t.definition(t.wrap([f(e.extAttrs),s(e.tokens.base),t.type(u(e.idlType)),i(e.tokens.name,{data:e,parent:n}),s(e.tokens.assign),s(e.tokens.value),s(e.tokens.termination)]),{data:e,parent:n})},typedef:function(e){return t.definition(t.wrap([f(e.extAttrs),s(e.tokens.base),t.type(u(e.idlType)),i(e.tokens.name,{data:e}),s(e.tokens.termination)]),{data:e})},includes:function(e){return t.definition(t.wrap([f(e.extAttrs),a(e.tokens.target,e.target),s(e.tokens.includes),a(e.tokens.mixin,e.includes),s(e.tokens.termination)]),{data:e})},callback:function(e){return t.definition(t.wrap([f(e.extAttrs),s(e.tokens.base),i(e.tokens.name,{data:e}),s(e.tokens.assign),t.type(u(e.idlType)),s(e.tokens.open),...e.arguments.map(l),s(e.tokens.close),s(e.tokens.termination)]),{data:e})},enum:function(e){return t.definition(t.wrap([f(e.extAttrs),s(e.tokens.base),i(e.tokens.name,{data:e}),s(e.tokens.open),g(e.values,e),s(e.tokens.close),s(e.tokens.termination)]),{data:e})},"enum-value":function(e,r){return t.wrap([t.trivia(e.tokens.value.trivia),t.definition(n`"${t.name(e.value,{data:e,parent:r})}"`,{data:e,parent:r}),s(e.tokens.separator)])},iterable:k,legacyiterable:k,maplike:k,setlike:k,"callback interface":y,eof:function(e){return t.trivia(e.trivia)}};function g(e,n){if(!e)return;const r=e.map(e=>(function(e,t){if(!b[e.type])throw new Error(`Type "${e.type}" is unsupported`);return b[e.type](e,t)})(e,n));return t.wrap(r)}return g(e)}function*k({unique:e,duplicates:t}){for(const n of t){const{name:t}=n,r=`The name "${t}" of type "${e.get(t).type}" was already seen`;yield s(n.source,n.tokens.name,n,r)}}function*b(e){const t=[...e.unique.values()].filter(e=>"interface"===e.type),n=function(){const t=new Map,n=e.all.filter(e=>"includes"===e.type);for(const r of n){const n=t.get(r.target),s=e.unique.get(r.includes);s&&(n?n.push(s):t.set(r.target,[s]))}return t}();for(const e of t)yield*r(e);function*r(t){const r=new Set(i(t).map(e=>e.name)),s=e.partials.get(t.name)||[],o=n.get(t.name)||[];for(const e of[...s,...o]){const n=i(e);yield*a(n,r,e,t);for(const e of n)r.add(e.name)}}function*a(e,t,n,r){for(const a of e){const{name:e}=a;if(e&&t.has(e)){const t=`The operation "${e}" has already been defined for the base interface "${r.name}" either in itself or in a mixin`;yield s(n.source,a.body.tokens.name,n,t)}}}function i(e){return e.members.filter(({type:e})=>"operation"===e)}}function g(e){const t=function(e){const t=new Map,n=new Set,r=new Map;for(const s of e)if(s.partial){const e=r.get(s.name);e?e.push(s):r.set(s.name,[s])}else s.name&&(t.has(s.name)?n.add(s):t.set(s.name,s));return{all:e,unique:t,partials:r,duplicates:n}}(e);return[...k(t),...b(t)]}n.d(t,"parse",function(){return d}),n.d(t,"write",function(){return y}),n.d(t,"validate",function(){return g})}])});
//# sourceMappingURL=webidl2.js.map